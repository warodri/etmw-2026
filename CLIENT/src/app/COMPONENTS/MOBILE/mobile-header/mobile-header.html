@let myUserObj = myUser();

@if (showLogin()) {
    <div class="fixed-top overlay"></div>
}
@if (showLogin()) {
    <!--
        PERFORM LOGN PANEL
    -->
    <div class="fixed-top etmw-bg-main text-light rounded-bottom-xl shadow border">
        <div class="container" style="max-width: 600px;">
            <div class="etmw-bg-main container d-flex justify-content-between align-items-center gap-3 px-4 pt-3 pb-3">
                <h2 class="m-0 fw-bold">
                    Login to ETMW
                </h2>
                <button class="btn btn-dark rounded-pill" (click)="toggleShowLogin()">
                    Close
                </button>
            </div>
            <div class="mt-3 rounded-bottom-xl">
                <div class="px-4 pb-4">
                    @if (!askForCode()) {
                        <!--
                            ENTER EMAIL
                        -->
                        <div class="row g-4">                
                            <div class="col-12">
                                <label class="contact-label">
                                    Your Email Address
                                </label>
                                <input 
                                    type="email" 
                                    [(ngModel)]="email"
                                    class="contact-input w-100" 
                                    placeholder="john@example.com"
                                    name="email">
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary btn-lg w-100 rounded-pill" (click)="sendCode()">
                                    <i class="bi bi-send-fill"></i>&nbsp;&nbsp;
                                    {{ working() ? 'Please wait...' : 'Send Code' }}
                                </button>
                                <div class="contact-form-note">
                                    We will send you a code to your Email
                                </div>
                            </div>
                        </div>
                    } @else {
                        <!--
                            ENTER CODE
                        -->
                        <div class="row g-4">                
                            <div class="col-12">
                                <label class="contact-label">Enter the Verification Code</label>
                                <input 
                                    type="number" 
                                    [(ngModel)]="code"
                                    class="contact-input" 
                                    placeholder="Type here the code you received in your Email..."
                                    name="email">
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary btn-lg w-100 rounded-pill" (click)="validateCode()">
                                    <i class="bi bi-send-fill"></i>&nbsp;&nbsp;
                                    {{ working() ? 'Please wait...' : 'Validate Code' }}
                                </button>
                                <div class="contact-form-note">
                                    Type the code you received in your Email
                                </div>
                            </div>
                        </div>
                    }        
                </div>
            </div>
        </div>
    </div>
} @else {
    <!--
        LOGIN AREA
    -->
    <div class="sticky-top px-3 pt-4 pb-4 text-light">
        <!--
            USER WANTS TO SEARCH
        -->
        @if (showSearch()) {

            <div class="bg-dark rounded-pill d-flex justify-content-between align-items-center gap-2 p-3">
                <input type="text" [(ngModel)]="query" class="border-0 bg-transparent text-light p-2 w-100 rounded-4" placeholder="Type to search..." />
                <button class="btn btn-secondary rounded-pill" (click)="toggleShowSearch()">
                    Close
                </button>
                <button class="btn btn-primary rounded-pill" (click)="executeSearch()">
                    Search
                </button>
            </div>

        } @else {
            <div class="container d-flex justify-content-between align-items-center gap-3">        
                <div class="d-flex justify-content-start align-items-center gap-2">
                    <!--
                        GO BACK BUTTON
                    -->
                    @if (showBack) {
                        <div class="rounded-circle d-flex justify-content-center align-items-center bg-dark pointer" style="width:50px; height:50px; object-fit: cover;">
                            <h3 class="m-0"><i class="bi bi-arrow-left"></i></h3>
                        </div>
                    }
                    @if(isLoggedIn()) {
                        <!--
                            SHOW USER IF LOGGED IN
                        -->
                        @if (myUserObj) {
                            <div class="d-flex justify-content-start align-items-center gap-2 etmw-bg-main rounded-5 pointer" (click)="gotoUserProfile()">
                                @if (myUserObj.profilePicture) {
                                    <img class="rounded-circle" [src]="myUserObj.profilePicture" style="width:50px; height:50px; object-fit: cover;" />
                                } @else {
                                    <img class="rounded-circle" src="nouser.png" style="width:50px; height:50px; object-fit: cover;" />
                                }
                                <div class="small p-2">
                                    <div>
                                        @if (!myUserObj.firstName) {
                                            No name
                                        } @else {
                                            {{ myUserObj.firstName }}
                                        }
                                        &nbsp;&nbsp;
                                    </div>
                                    <div class="text-gray-400">
                                        @if (myUserObj.isAuthor) {
                                            Author
                                        } @else {
                                            Listener
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    } @else {
                        <!--
                            SHOW LOGIN BUTTON
                        -->
                        <div class="d-flex justify-content-start align-items-center gap-1 etmw-bg-main rounded-5">
                            <div class="small p-2">
                                <button class="btn btn-primary rounded-pill" (click)="toggleShowLogin()">
                                    Login
                                </button>
                            </div>
                        </div>
                    }
                </div>
                <div class="d-flex justify-content-end align-items-center gap-2">
                    <!--
                        SEARCH ICON
                    -->                
                    <div class="rounded-circle d-flex justify-content-center align-items-center bg-dark position-relative pointer" style="width:50px; height:50px; object-fit: cover;" (click)="toggleShowSearch()">
                        <h3 class="m-0"><i class="bi bi-search text-gray-400"></i></h3>
                    </div>
                    <!--
                        MESSAGES AND UNREAD COUNT
                    -->
                    @if(isLoggedIn()) {
                        <div class="rounded-circle d-flex justify-content-center align-items-center bg-dark position-relative pointer" style="width:50px; height:50px; object-fit: cover;" (click)="gotoInbox()">
                            <h3 class="m-0"><i class="bi bi-chat-dots"></i></h3>
                            @if (unreadConversations() > 0) {
                                <div class="rounded-pill px-2 bg-danger text-light small position-absolute" style="right:0; top:5px;">
                                    {{ unreadConversations() }}
                                </div>
                            }
                        </div>
                    }    
                </div>
            </div>
        }
    </div>
}
