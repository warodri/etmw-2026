@let audiobookObj = audiobook();
@let errorMessageObj = errorMessage();

@if (audiobookObj) {

    <div class="container-fluid p-0 min-vh-100 d-flex flex-column bg-slate-900">
        
        <div class="flex-grow-1 d-flex flex-column justify-content-between p-4">
            
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center">
                <button class="btn btn-link text-white p-0" (click)="goBack()">
                    <i class="bi bi-chevron-down" style="font-size: 1.5rem;"></i>
                </button>
                <div class="d-flex gap-3">
                    <button class="btn btn-link text-white p-0">
                        <i class="bi bi-heart" [class.bi-heart-fill]="isLiked" [class.text-danger]="isLiked" style="font-size: 1.5rem;"></i>
                    </button>
                    <button class="btn btn-link text-white p-0">
                        <i class="bi bi-three-dots" style="font-size: 1.5rem;"></i>
                    </button>
                </div>
            </div>

            <!-- Audiobook Info -->
            <div class="text-center my-4">
                <div class="bg-white rounded-5 p-4 mx-auto shadow-lg" style="max-width: 340px; transform: perspective(1000px) rotateY(-5deg);">
                    <img [src]="coverFile()" 
                        class="w-100 rounded-4" 
                        style="aspect-ratio: 3/4; object-fit: cover;"
                        [alt]="audiobookObj.title" />
                </div>
            </div>
            <div class="mb-4">
                <h4 class="fw-bold mb-2 text-center" style="color: var(--color-primary);">{{ audiobookObj.title }}</h4>
                <p class="text-gray-400 text-center mb-0">{{ audiobookObj.authorName }}</p>
            </div>
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small text-white">{{ currentTime() }}</span>
                    <span class="small text-gray-400">{{ totalTime() }}</span>
                </div>
                <div class="progress" style="height: 4px; background-color: rgba(255, 255, 255, 0.1);">
                    <div class="progress-bar" 
                        [style.width.%]="progressPercent()"
                        style="background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);"></div>
                </div>
            </div>

            <!-- Controls -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <!-- Skip back -->
                <button class="btn btn-link text-white p-0" (click)="skipBackward(15)" [attr.disabled]="!audioLoaded()">
                    <i class="bi bi-arrow-counterclockwise" style="font-size: 1.75rem;"></i>
                    <div class="small" style="margin-top: -8px;">15</div>
                </button>
                <button class="btn btn-link text-white p-0">
                    <i class="bi bi-skip-backward-fill" style="font-size: 2rem;"></i>
                </button>
                <!-- play -->
                <button class="btn btn-white rounded-circle d-flex align-items-center justify-content-center shadow-lg" 
                        [attr.disabled]="!audioLoaded()"        
                        (click)="togglePlay()"
                        style="width: 70px; height: 70px; background-color: white; border: none;">
                    <i class="bi" [class.bi-pause-fill]="isPlaying" [class.bi-play-fill]="!isPlaying" style="font-size: 2rem; color: #1a1f2e;"></i>
                </button>
                <!-- Skip Forward -->
                <button class="btn btn-link text-white p-0">
                    <i class="bi bi-skip-forward-fill" style="font-size: 2rem;"></i>
                </button>                
                <button class="btn btn-link text-white p-0" (click)="skipForward(15)" [attr.disabled]="!audioLoaded()">
                    <i class="bi bi-arrow-clockwise" style="font-size: 1.75rem;"></i>
                    <div class="small" style="margin-top: -8px;">15</div>
                </button>
            </div>

            <!-- 
                List of chapters
            -->
            <div class="bg-secondary rounded-4 p-3 d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <i class="bi bi-music-note-list text-white" style="font-size: 1.5rem;"></i>
                    <div>
                        <div class="fw-semibold small">{{ currentChapter }}</div>
                        <div class="text-gray-400" style="font-size: 0.75rem;">Chapter {{ chapterNumber }} of {{ totalChapters }}</div>
                    </div>
                </div>
                <i class="bi bi-chevron-right text-gray-400"></i>
            </div>

        </div>

    </div>

}
